<div class="min-h-screen bg-gray-100 py-8 px-4 sm:px-6 lg:px-8">
  <div class="max-w-3xl mx-auto">
    <!-- Header -->
    <div class="mb-8 flex justify-between items-center">
      <div>
        <h1 class="text-3xl font-bold text-gray-900">Edit Article</h1>
        <p class="mt-2 text-sm text-gray-600">Update the article details below.</p>
      </div>

      <!-- Publish/Unpublish Button - Only shown if user has 'publish' permission -->
      @if (canPublish && article) {
      <button
        (click)="onTogglePublish()"
        [disabled]="isLoading || isLoadingArticle"
        [class]="
          article.isPublished
            ? 'bg-yellow-100 hover:bg-yellow-200 text-yellow-800'
            : 'bg-green-100 hover:bg-green-200 text-green-800'
        "
        class="font-semibold py-2 px-6 rounded-lg transition disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2"
      >
        @if (article.isPublished) {
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728A9 9 0 015.636 5.636m12.728 12.728L5.636 5.636"
          />
        </svg>
        <span>Unpublish</span>
        } @else {
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M5 13l4 4L19 7"
          />
        </svg>
        <span>Publish</span>
        }
      </button>
      }
    </div>

    <!-- Loading State -->
    @if (isLoadingArticle) {
    <div class="flex justify-center items-center py-12">
      <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"></div>
    </div>
    }

    <!-- Error Message -->
    @if (errorMessage && !isLoadingArticle) {
    <div class="mb-6 p-4 bg-red-50 border border-red-200 rounded-lg">
      <p class="text-sm text-red-600">{{ errorMessage }}</p>
    </div>
    }

    <!-- Form -->
    @if (!isLoadingArticle && article) {
    <div class="bg-white rounded-lg shadow-md p-8">
      <!-- Status Badge -->
      <div class="mb-6">
        <span
          [class]="
            article.isPublished ? 'bg-green-100 text-green-800' : 'bg-yellow-100 text-yellow-800'
          "
          class="inline-block px-3 py-1 text-sm font-semibold rounded-full"
        >
          {{ article.isPublished ? 'Published' : 'Draft' }}
        </span>
      </div>

      <form [formGroup]="articleForm" (ngSubmit)="onSubmit()" class="space-y-6">
        <!-- Title -->
        <div>
          <label for="title" class="block text-sm font-medium text-gray-700 mb-1">
            Title <span class="text-red-500">*</span>
          </label>
          <input
            id="title"
            type="text"
            formControlName="title"
            [disabled]="!canEdit"
            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition disabled:bg-gray-100"
            [class.border-red-500]="title?.invalid && title?.touched"
            placeholder="Enter article title"
          />
          @if (title?.invalid && title?.touched) {
          <p class="mt-1 text-sm text-red-600">
            @if (title?.errors?.['required']) { Title is required } @if
            (title?.errors?.['minlength']) { Title must be at least 3 characters }
          </p>
          }
        </div>

        <!-- Body -->
        <div>
          <label for="body" class="block text-sm font-medium text-gray-700 mb-1">
            Body <span class="text-red-500">*</span>
          </label>
          <textarea
            id="body"
            formControlName="body"
            [disabled]="!canEdit"
            rows="10"
            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition disabled:bg-gray-100 resize-none"
            [class.border-red-500]="body?.invalid && body?.touched"
            placeholder="Enter article content"
          ></textarea>
          @if (body?.invalid && body?.touched) {
          <p class="mt-1 text-sm text-red-600">
            @if (body?.errors?.['required']) { Body is required } @if (body?.errors?.['minlength'])
            { Body must be at least 10 characters }
          </p>
          }
        </div>

        <!-- Image URL -->
        <div>
          <label for="image" class="block text-sm font-medium text-gray-700 mb-1">
            Image URL (Optional)
          </label>
          <input
            id="image"
            type="text"
            formControlName="image"
            [disabled]="!canEdit"
            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition disabled:bg-gray-100"
            placeholder="Enter image URL (optional)"
          />
          <p class="mt-1 text-xs text-gray-500">Leave empty if no image is needed</p>
        </div>

        <!-- Actions -->
        <div class="flex gap-4 pt-4">
          <button
            type="submit"
            [disabled]="isLoading || !canEdit"
            class="flex-1 bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-6 rounded-lg transition disabled:opacity-50 disabled:cursor-not-allowed"
          >
            @if (isLoading) {
            <span>Updating...</span>
            } @else {
            <span>Update Article</span>
            }
          </button>
          <button
            type="button"
            (click)="onCancel()"
            [disabled]="isLoading"
            class="bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold py-2 px-6 rounded-lg transition disabled:opacity-50"
          >
            Cancel
          </button>
        </div>
      </form>
    </div>
    }
  </div>
</div>
